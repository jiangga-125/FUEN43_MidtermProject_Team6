@model BookLoop.Areas.Members.ViewModels.CouponEditVm
@{
    ViewData["Title"] = "修改優惠券";
}

<h2 class="mb-3">@ViewData["Title"]</h2>

<form asp-action="Edit" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="CouponID" />

    <div class="alert alert-info py-2">
        <strong>說明：</strong>「百分比折扣」的折扣值 <code>10</code> 表「打九折（-10%）」；最高折抵通常在％數時使用。留空＝不限制。
    </div>

    <div class="row g-4">
        <!-- 左側：基本設定 -->
        <div class="col-lg-7">
            <div class="card shadow-sm">
                <div class="card-header fw-bold">基本設定</div>
                <div class="card-body">

                    <div class="mb-3">
                        <label asp-for="Name" class="form-label">優惠券名稱</label>
                        <input asp-for="Name" class="form-control" />
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="Code" class="form-label">優惠碼</label>
                            <input asp-for="Code" class="form-control" />
                            <span asp-validation-for="Code" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="DiscountType" class="form-label">折扣類型</label>
                            <select asp-for="DiscountType" class="form-select">
                                <option value="0">金額折抵</option>
                                <option value="1">百分比折扣</option>
                            </select>
                            <span asp-validation-for="DiscountType" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="DiscountValue" class="form-label">折扣值</label>
                            <input asp-for="DiscountValue" class="form-control" type="number" step="0.01" />
                            <div class="form-text">金額：例如 100；百分比：例如 10（=打九折）</div>
                            <span asp-validation-for="DiscountValue" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="MaxDiscountAmount" class="form-label">最高折抵（選填）</label>
                            <input asp-for="MaxDiscountAmount" class="form-control" type="number" step="0.01" />
                            <span asp-validation-for="MaxDiscountAmount" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="MinOrderAmount" class="form-label">最低消費（選填）</label>
                            <input asp-for="MinOrderAmount" class="form-control" type="number" step="0.01" />
                            <span asp-validation-for="MinOrderAmount" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="MaxUsesPerMember" class="form-label">每會員最多次數（選填）</label>
                            <input asp-for="MaxUsesPerMember" class="form-control" type="number" min="0" />
                            <div class="form-text">空白＝不限；填 1 表「同會員限用一次」。</div>
                            <span asp-validation-for="MaxUsesPerMember" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label asp-for="StartAt" class="form-label">開始時間</label>
                            <input asp-for="StartAt" type="datetime-local" class="form-control"
                                   value="@Model.StartAt?.ToString("yyyy-MM-ddTHH:mm")" />
                            <span asp-validation-for="StartAt" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label asp-for="EndAt" class="form-label">結束時間</label>
                            <input asp-for="EndAt" type="datetime-local" class="form-control"
                                   value="@Model.EndAt?.ToString("yyyy-MM-ddTHH:mm")" />
                            <span asp-validation-for="EndAt" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-check mb-2">
                        <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActiveSwitch" />
                        <label class="form-check-label" for="isActiveSwitch">啟用狀態</label>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Description" class="form-label">簡介 / 說明（選填）</label>
                        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="TermsText" class="form-label">條款與細則（選填）</label>
                        <textarea asp-for="TermsText" class="form-control" rows="4"
                                  placeholder="使用限制、不可併用、退貨處理…"></textarea>
                    </div>

                </div>
            </div>
        </div>

        <!-- 右側：適用分類 -->
        <div class="col-lg-5">
            <div class="card shadow-sm">
                <div class="card-header fw-bold">適用分類限制</div>
                <div class="card-body">
                    <div class="mb-2">
                        <label class="form-label">僅限可用分類（可多選）</label>
                        <select asp-for="SelectedCategoryIds"
                                asp-items="Model.CategoryOptions"
                                class="form-select" multiple size="12">
                        </select>
                        <div class="form-text">留空＝不限制分類（全站可用）。</div>
                    </div>

                    <div class="alert alert-secondary py-2 mb-0">
                        <small class="d-block">
                            若你的商品有父子分類，檢核時請自行決定是否包含子分類。
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 d-flex gap-2">
        <button type="submit" class="btn btn-success">儲存修改</button>
        <a asp-action="Index" class="btn btn-outline-secondary">返回清單</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
