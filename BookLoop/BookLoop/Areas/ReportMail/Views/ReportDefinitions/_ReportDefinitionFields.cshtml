@model BookLoop.Data.Entities.ReportDefinition
@{
    // 從 ViewData 帶入模式與 API
    var mode = (string?)ViewData["Mode"] ?? "create"; // create|edit
    var defId = (int?)ViewData["DefId"] ?? 0;
    var apiDef = (string?)ViewData["ApiDef"] ?? "#";
    var apiCats = (string?)ViewData["ApiCats"] ?? "#";
    var apiPreview = (string?)ViewData["ApiPreview"] ?? "#";
}

<input type="hidden" asp-for="ReportDefinitionID" />
<input type="hidden" asp-for="Category" id="hidCategory" value="line" />
<input type="hidden" id="FiltersJson" name="FiltersJson" />

<div id="rd-form"
     data-mode="@mode"
     data-def-id="@defId"
     data-api-def="@apiDef"
     data-api-cats="@apiCats"
     data-api-preview="@apiPreview">

    <div class="mb-3">
        <label asp-for="ReportName" class="form-label">報表名稱</label>
        <input asp-for="ReportName" class="form-control" />
        <span asp-validation-for="ReportName" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="BaseKind" class="form-label">基礎報表</label>
        <select asp-for="BaseKind" id="baseKind" class="form-select">
            <option value="sales">書籍銷售量</option>
            <option value="borrow">書籍借閱量</option>
            <option value="orders">訂單</option>
        </select>
        <span asp-validation-for="BaseKind" class="text-danger"></span>
        <div class="form-text">依選擇顯示對應篩選欄位</div>
    </div>

    <hr />

    <!-- 日期區間與粒度（共用） -->
    <div class="mb-2 fw-bold">日期區間與粒度</div>
    <div class="row g-2 align-items-end mb-3">
        <div class="col">
            <label class="form-label">起</label>
            <input type="date" id="dateFrom" class="form-control" />
        </div>
        <div class="col">
            <label class="form-label">迄</label>
            <input type="date" id="dateTo" class="form-control" />
        </div>
        <div class="col-auto">
            <div class="form-check"><input class="form-check-input" type="radio" name="gran" id="gDay" value="day"><label class="form-check-label" for="gDay">日</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="gran" id="gMonth" value="month"><label class="form-check-label" for="gMonth">月</label></div>
            <div class="form-check"><input class="form-check-input" type="radio" name="gran" id="gYear" value="year"><label class="form-check-label" for="gYear">年</label></div>
        </div>
    </div>

    <!-- sales -->
    <div id="section-sales" class="border rounded p-3 mb-3" style="display:none">
        <div class="mb-2 fw-bold">銷售篩選</div>
        <div class="mb-3">
            <label class="form-label">書籍種類</label>
            <select id="salesCategories" class="form-select" multiple></select>
            <div class="form-text">選「（全部）」或不選＝全部</div>
        </div>
        <div class="mb-3">
            <label class="form-label">單本價位</label>
            <select id="priceRange" class="form-select"></select>
            <div class="form-text">每 100 元一區間（1~1000）</div>
        </div>
    </div>

    <!-- borrow -->
    <div id="section-borrow" class="border rounded p-3 mb-3" style="display:none">
        <div class="mb-2 fw-bold">借閱篩選</div>
        <div class="mb-3">
            <label class="form-label">書籍種類</label>
            <select id="borrowCategories" class="form-select" multiple></select>
            <div class="form-text">選「（全部）」或不選＝全部</div>
        </div>
    </div>

    <!-- orders -->
    <div id="section-orders" class="border rounded p-3 mb-3" style="display:none">
        <div class="mb-2 fw-bold">訂單篩選</div>

        <div class="mb-3">
            <label class="form-label d-block">指標</label>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="metric" id="mAmount" value="amount">
                <label class="form-check-label" for="mAmount">總銷售金額</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="metric" id="mCount" value="count">
                <label class="form-check-label" for="mCount">訂單筆數</label>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label d-block">訂單狀態</label>
            <div id="orderStatusGroup" class="d-flex flex-wrap gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="os_all">
                    <label class="form-check-label" for="os_all">全選</label>
                </div>
                <div class="form-check"><input class="form-check-input os" type="checkbox" id="os_0" data-val="0"><label class="form-check-label" for="os_0">待處理</label></div>
                <div class="form-check"><input class="form-check-input os" type="checkbox" id="os_1" data-val="1"><label class="form-check-label" for="os_1">已付款</label></div>
                <div class="form-check"><input class="form-check-input os" type="checkbox" id="os_2" data-val="2"><label class="form-check-label" for="os_2">已出貨</label></div>
                <div class="form-check"><input class="form-check-input os" type="checkbox" id="os_3" data-val="3"><label class="form-check-label" for="os_3">已完成</label></div>
                <div class="form-check"><input class="form-check-input os" type="checkbox" id="os_4" data-val="4"><label class="form-check-label" for="os_4">已取消</label></div>
            </div>
            <div class="form-text">全選＝不加狀態條件；全不勾＝空結果</div>
        </div>

        <div class="row g-2">
            <div class="col">
                <label class="form-label">單筆金額（Min）</label>
                <input type="number" id="ordAmtMin" class="form-control" placeholder="0" />
            </div>
            <div class="col">
                <label class="form-label">單筆金額（Max）</label>
                <input type="number" id="ordAmtMax" class="form-control" placeholder="999999" />
            </div>
        </div>
    </div>

    <div class="mb-3">
        <label asp-for="Description" class="form-label">描述</label>
        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
    </div>

    <div class="form-check mb-3">
        <input class="form-check-input" asp-for="IsActive" />
        <label class="form-check-label" asp-for="IsActive">啟用</label>
    </div>
</div>
