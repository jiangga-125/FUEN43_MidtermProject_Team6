@model ExportLogVM
@{
    ViewData["Title"] = "匯出紀錄詳情";
    Layout = "~/Views/Shared/_Layout.cshtml";

    string StatusText(byte s) => s switch { 1 => "Sent", 2 => "Failed", _ => s.ToString() };
    string StatusBadge(byte s) => s switch { 1 => "success", 2 => "danger", _ => "secondary" };
    string FullHex(byte[]? b) => b == null ? "-" : BitConverter.ToString(b).Replace("-", "").ToLowerInvariant();

    string sizeText = ViewBag.SizeText as string ?? (Model.AttachmentBytes + " B");
    string filtersPretty = ViewBag.FiltersPretty as string ?? "(empty)";

    // 依紀錄格式判斷：pdf 或 xlsx（其他一律當 xlsx）
    var isPdf = string.Equals(Model.Format, "pdf", StringComparison.OrdinalIgnoreCase);
    var downloadUrl = Url.Action(
        isPdf ? "DownloadPdf" : "DownloadExcel",
        "ExportLogs",
        new { area = "ReportMail", id = Model.ExportID }
    );
}

<div class="container-xxl px-3 px-md-4 px-xxl-5 py-3">

    <!-- 工具列：置中 + 在兩張卡片正上方 -->
    <div class="d-flex flex-column align-items-center gap-2 mb-3">
        <h1 class="h5 mb-0">匯出紀錄 <span class="text-muted">#@Model.ExportID</span></h1>
        <div class="d-flex gap-2">
            <a class="btn btn-secondary btn-sm" href="@Url.Action("Index", "ExportLogs", new { area = "ReportMail" })">回列表</a>
        </div>
    </div>

    <!-- 兩張卡片 -->
    <div class="row g-3 justify-content-center">
        <div class="col-12 col-lg-5">
            <div class="card shadow-sm">
                <div class="card-header py-2">基本</div>
                <div class="card-body p-3 p-md-4">
                    <div>時間：<span title="@Model.RequestedAt.ToString("O")">@Model.RequestedAt:yyyy/MM/dd HH:mm:ss</span></div>
                    <div>
                        格式：
                        <span class="badge bg-@(Model.Format == "xlsx" ? "success" : (Model.Format == "pdf" ? "danger" : "secondary"))">@Model.Format</span>
                        狀態：<span class="badge bg-@StatusBadge(Model.Status)">@StatusText(Model.Status)</span>
                    </div>
                    <div>Email：<a href="mailto:@Model.TargetEmail">@Model.TargetEmail</a></div>
                    <div>
                        檔案：<code>@Model.AttachmentFileName</code>（@sizeText）<a class="btn btn-primary btn-sm" href="@downloadUrl">下載</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-5">
            <div class="card shadow-sm">
                <div class="card-header py-2">來源</div>
                <div class="card-body p-3 p-md-4">
                    <div>使用者：@Model.UserID</div>
                    <div>書商：@(Model.SupplierID?.ToString() ?? "-")</div>
                    <div>定義：@(Model.DefinitionID?.ToString() ?? "-")</div>
                    <div>名稱：@Model.ReportName <span class="text-muted">(@Model.Category)</span></div>
                    <div class="small text-muted">Policy：@Model.PolicyUsed</div>
                    <div class="small text-muted">IP：@Model.Ip</div>
                    <div class="small text-muted">UA：@Model.UserAgent</div>
                </div>
            </div>
        </div>
    </div>
</div>
