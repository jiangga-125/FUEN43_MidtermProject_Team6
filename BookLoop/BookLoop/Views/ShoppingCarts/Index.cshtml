@model IEnumerable<BookLoop.Models.ShoppingCart>
@using BookLoop

@{
    ViewData["Title"] = "Shopping Carts";
}

<h1>購物車</h1>

<p>
    <a asp-action="Create" class="btn btn-primary">Create New Cart</a>
</p>

<!-- 加入書籍到購物車 -->
<div class="card mb-4 p-3">
    <form asp-action="AddToCart" method="post" class="row g-2 align-items-center">
        <div class="col-auto">
            <label for="MemberId" class="form-label">選擇會員:</label>
            <select name="memberId" id="MemberId" class="form-select">
                <option value="">-- 請選擇會員 --</option>
                @foreach (var member in ViewBag.Members as List<BookLoop.Member>)
                {
                    <option value="@member.MemberID">@member.Username (@member.MemberID)</option>
                }
            </select>
        </div>
        <div class="col-auto">
            <label for="BookId" class="form-label">選擇書籍:</label>
            <select name="bookId" id="BookId" class="form-select">
                @foreach (var book in ViewBag.Books as List<BookLoop.Models.Book>)
                {
                    <option value="@book.BookID">@book.Title - @book.ListPrice.ToString("C")</option>
                }
            </select>
        </div>
        <div class="col-auto">
            <label for="Quantity" class="form-label">數量:</label>
            <input type="number" name="quantity" id="Quantity" value="1" min="1" class="form-control" style="width:80px;" />
        </div>
        <div class="col-auto align-self-end">
            <button type="submit" class="btn btn-success" id="addToCartBtn" disabled>加入購物車</button>
        </div>
    </form>
</div>

<table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
        <tr>
            <th>@Html.DisplayNameFor(model => model.First().CreatedDate)</th>
            <th>@Html.DisplayNameFor(model => model.First().IsActive)</th>
            @* <th>@Html.DisplayNameFor(model => model.First().UpdatedDate)</th> *@
            <th>會員ID</th>
            <th>使用者</th>
            <th>商品數量</th>
            <th>編輯</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var cart in Model)
        {
            <tr>
                <td>@cart.CreatedDate.ToString("yyyy-MM-dd HH:mm")</td>
                <td>@(cart.IsActive ? "Active" : "Inactive")</td>
                @* <td>@cart.UpdatedDate.ToString("yyyy-MM-dd HH:mm")</td> *@
                <td>@(cart.Member != null ? cart.Member.MemberID.ToString() : "N/A")</td>
                <td>@(cart.Member != null ? cart.Member.Username : "未指定")</td>
                <td>@cart.Items.Count()</td>
                <td>
                    <a asp-action="ViewCart" asp-route-id="@cart.CartID" class="btn btn-sm btn-info">查看購物車</a>
                    <a asp-action="Delete" asp-route-id="@cart.CartID" class="btn btn-sm btn-danger">刪除</a>
                </td>
            </tr>
        }
    </tbody>
</table>


@section Scripts {
    <script>
        const memberSelect = document.getElementById('MemberId');
        const addBtn = document.getElementById('addToCartBtn');

        memberSelect.addEventListener('change', function () {
            addBtn.disabled = memberSelect.value === "";
        });
    </script>
}