@model ReportMail.Data.Entities.ReportDefinition
@{
    ViewData["Title"] = "編輯報表";
    var lc = (Model?.Category ?? "line").ToLowerInvariant();
    var currentCategory = (lc == "line" || lc == "bar" || lc == "pie") ? lc : "line";
    Func<string, string> Btn = key => currentCategory == key ? "btn btn-sm btn-primary" : "btn btn-sm btn-outline-secondary";
}

<h1 class="mb-3">編輯報表</h1>

<!-- 圖表類型切換（Edit 頁：就地切 hidden，不跳頁） -->
<div class="btn-group mb-3" role="group" aria-label="chart type">
    <button type="button" class="@Btn("line")" data-chart="line">折線圖</button>
    <button type="button" class="@Btn("bar")" data-chart="bar">長條圖</button>
    <button type="button" class="@Btn("pie")" data-chart="pie">圓餅圖</button>
</div>

<hr />

<div class="row">
    <div class="col-md-6">
        <form asp-area="ReportMail" asp-controller="ReportDefinitions" asp-action="Edit" method="post">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <input type="hidden" asp-for="ReportDefinitionID" />
            <!-- 類型用 hidden 綁定，按鈕會就地修改它 -->
            <input type="hidden" asp-for="Category" id="hidCategory" />

            <div class="mb-3">
                <label asp-for="ReportName" class="form-label">名稱</label>
                <input asp-for="ReportName" class="form-control" />
                <span asp-validation-for="ReportName" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Description" class="form-label">說明</label>
                <textarea asp-for="Description" class="form-control" rows="3"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" asp-for="IsActive" />
                <label class="form-check-label" asp-for="IsActive">啟用</label>
            </div>

            <!-- 時間戳由 DbContext 自動處理，視圖不送出 -->
            <button type="submit" class="btn btn-primary">儲存</button>
            <a asp-area="ReportMail" asp-controller="ReportDefinitions" asp-action="Index" class="btn btn-secondary">返回列表</a>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // 就地切換 Category（不跳頁）
        (function(){
          const hid = document.getElementById('hidCategory');
          const btns = document.querySelectorAll('[data-chart]');
          btns.forEach(b=>{
            b.addEventListener('click', () => {
              const v = b.getAttribute('data-chart');
              hid.value = v;
              // 視覺高亮
              btns.forEach(x=>x.classList.replace('btn-primary','btn-outline-secondary'));
              b.classList.replace('btn-outline-secondary','btn-primary');
            });
          });
        })();
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
