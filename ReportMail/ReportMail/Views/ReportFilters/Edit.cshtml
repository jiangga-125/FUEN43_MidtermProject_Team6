@model ReportMail.Models.ReportFilter

@{
    ViewData["Title"] = "編輯篩選欄位";
    var currentReportDefinitionId = Context.Request.Query["reportDefinitionId"];
}

<h1 class="mb-3">編輯篩選欄位</h1>

<form asp-action="Edit" method="post">
    @Html.AntiForgeryToken()

    @* 主鍵要送回去（scaffold 既有做法） *@
    <input type="hidden" asp-for="ReportFilterId" />

    @* 讓 Controller 知道儲存後要回到哪一份報表的欄位列表 *@
    <input type="hidden" name="reportDefinitionId" value="@currentReportDefinitionId" />

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    @* 報表：下拉（維持目前選取） *@
    <div class="mb-3">
        <label class="form-label">報表</label>
        <select class="form-select" asp-for="ReportDefinitionId" asp-items="ViewBag.ReportDefinitionId"></select>
        <span asp-validation-for="ReportDefinitionId" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">欄位英文名稱</label>
        <input class="form-control" asp-for="FieldName" />
        <span asp-validation-for="FieldName" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">顯示名稱</label>
        <input class="form-control" asp-for="DisplayName" />
        <span asp-validation-for="DisplayName" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">資料型別</label>
        <input class="form-control" asp-for="DataType" />
        <span asp-validation-for="DataType" class="text-danger"></span>
    </div>

    <!-- ★ 資料型別（下拉） -->
    <div class="mb-3">
        <label class="form-label">資料型別</label>
        <select class="form-select" asp-for="DataType" asp-items="ViewBag.DataTypeOptions"></select>
        <span asp-validation-for="DataType" class="text-danger"></span>
    </div>

    <!-- ★ 運算子（下拉） -->
    <div class="mb-3">
        <label class="form-label">運算子</label>
        <select class="form-select" asp-for="Operator" asp-items="ViewBag.OperatorOptions"></select>
        <span asp-validation-for="Operator" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">選項</label>
        <textarea class="form-control" asp-for="Options" rows="3"></textarea>
        <span asp-validation-for="Options" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">排序</label>
        <input class="form-control" asp-for="OrderIndex" type="number" step="1" />
        <span asp-validation-for="OrderIndex" class="text-danger"></span>
    </div>

    <div class="mb-3 form-check">
        <input class="form-check-input" asp-for="IsRequired" />
        <label class="form-check-label" asp-for="IsRequired">必填</label>
    </div>

    <div class="mb-4 form-check">
        <input class="form-check-input" asp-for="IsActive" />
        <label class="form-check-label" asp-for="IsActive">啟用</label>
    </div>

    @* 這兩個欄位在編輯頁只做顯示，不可編輯（由後端在 Edit POST 時更新 UpdatedAt） *@
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <label class="form-label">建立時間</label>
            <input class="form-control" value="@(Model.CreatedAt.ToString("yyyy/MM/dd HH:mm"))" disabled />
        </div>
        <div class="col-md-6">
            <label class="form-label">最後更新</label>
            <input class="form-control" value="@(Model.UpdatedAt.ToString("yyyy/MM/dd HH:mm"))" disabled />
        </div>
    </div>

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">儲存</button>
        <a class="btn btn-secondary" asp-action="Index" asp-route-reportDefinitionId="@currentReportDefinitionId">返回列表</a>
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
