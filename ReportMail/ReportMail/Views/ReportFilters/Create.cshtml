@model ReportMail.Models.ReportFilter

@{
    ViewData["Title"] = "新增篩選欄位";

    // 目前所在的報表（若從某報表清單點進來，QueryString 會帶 reportDefinitionId）
    // 這個值只用來「送出後導回同一報表的欄位列表」，不會寫進資料庫
    var currentReportDefinitionId = Context.Request.Query["reportDefinitionId"];
}

<h1 class="mb-3">新增篩選欄位</h1>

<form asp-action="Create" method="post">
    <!--反 CSRF（雖然 form tag helper 預設會加，這裡明確放進來較直觀） -->
    @Html.AntiForgeryToken()

    <!--讓 Controller 能知道儲存後要回到哪一份報表的欄位列表 -->
    <input type="hidden" name="reportDefinitionId" value="@currentReportDefinitionId" />

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="mb-3">
        <label class="form-label">報表</label>
        <select class="form-select" asp-for="ReportDefinitionId" asp-items="ViewBag.ReportDefinitionId"></select>
        <span asp-validation-for="ReportDefinitionId" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">欄位英文名稱</label>
        <input class="form-control" asp-for="FieldName" />
        <span asp-validation-for="FieldName" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label class="form-label">顯示名稱</label>
        <input class="form-control" asp-for="DisplayName" />
        <span asp-validation-for="DisplayName" class="text-danger"></span>
    </div>

    <!-- ★ 資料型別（下拉；選項由 Controller 的 ViewBag.DataTypeOptions 提供） -->
    <div class="mb-3">
        <label class="form-label">資料型別</label>
        <select class="form-select" asp-for="DataType" asp-items="ViewBag.DataTypeOptions"></select>
        <span asp-validation-for="DataType" class="text-danger"></span>
    </div>

    <!-- ★ 運算子（下拉；選項由 Controller 的 ViewBag.OperatorOptions 提供） -->
    <div class="mb-3">
        <label class="form-label">運算子</label>
        <select class="form-select" asp-for="Operator" asp-items="ViewBag.OperatorOptions"></select>
        <span asp-validation-for="Operator" class="text-danger"></span>
    </div>

    @* 預設值（選填） *@
    <div class="mb-3">
        <label class="form-label">預設值</label>
        <input class="form-control" asp-for="DefaultValue" />
        <span asp-validation-for="DefaultValue" class="text-danger"></span>
    </div>

    @* 選項（選填；字串格式依你資料庫定義，這裡不強加格式） *@
    <div class="mb-3">
        <label class="form-label">選項</label>
        <textarea class="form-control" asp-for="Options" rows="3"></textarea>
        <span asp-validation-for="Options" class="text-danger"></span>
    </div>

    <!-- 排序（數字愈小排愈前） -->
    <div class="mb-3">
        <label class="form-label">排序</label>
        <input class="form-control" asp-for="OrderIndex" type="number" step="1" />
        <span asp-validation-for="OrderIndex" class="text-danger"></span>
    </div>

    <!-- 必填 / 啟用（布林值用核取方塊） -->
    <div class="mb-3 form-check">
        <input class="form-check-input" asp-for="IsRequired" />
        <label class="form-check-label" asp-for="IsRequired">必填</label>
    </div>

    <div class="mb-4 form-check">
        <input class="form-check-input" asp-for="IsActive" />
        <label class="form-check-label" asp-for="IsActive">啟用</label>
    </div>

    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">儲存</button>
        <!--  返回列表時保留目前的 reportDefinitionId -->
        <a class="btn btn-secondary" asp-action="Index" asp-route-reportDefinitionId="@currentReportDefinitionId">返回列表</a>
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
